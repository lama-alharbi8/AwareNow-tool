{% extends "core/base.html" %}
{% load static %}

{% block title %}Create Template{% endblock %}

{% block content %}
<div class="container" style="max-width:900px;">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="fw-bold mb-0">
        {% if is_edit %}Edit Template{% else %}Create Template{% endif %}
      </h3>
      <small class="text-muted">Phishing email template</small>
    </div>

    <a href="{% url 'campaigns:templates_dashboard' %}" class="btn btn-outline-dark">
      Back
    </a>
  </div>

  <form method="post" enctype="multipart/form-data" class="row g-4">
    {% csrf_token %}

    <!-- Template Info -->
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <h5 class="fw-semibold mb-3">Template Information</h5>

          <div class="mb-3">
            <label class="form-label small">Template Name *</label>
            {{ form.name }}
          </div>

          <div class="mb-3">
            <label class="form-label small">Email Subject *</label>
            {{ form.subject }}
          </div>

          <div class="mb-3">
            <label class="form-label small">Preview Image</label>
            {{ form.preview_image }}
          </div>

          <div class="mb-3">
            <label class="form-label small">HTML Content *</label>
            {{ form.html_content }}
          </div>
        </div>
      </div>
    </div>

    <!-- Publishing -->
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <h5 class="fw-semibold mb-3">Template Publishing</h5>

          <div class="form-check mb-3">
            <input class="form-check-input"
                   type="radio"
                   name="visibility"
                   value="private"
                   {% if not form.instance.is_published %}checked{% endif %}
                   {% if form.instance.is_published %}disabled{% endif %}>
            <label class="form-check-label fw-medium text-muted">
              Save as Draft
            </label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input"
                   type="radio"
                   name="visibility"
                   value="global"
                   {% if form.instance.visibility == "global" %}checked{% endif %}>
            <label class="form-check-label fw-medium">
              Publish to all companies
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input"
                   type="radio"
                   name="visibility"
                   value="specific"
                   id="publish_specific"
                   {% if form.instance.visibility == "specific" %}checked{% endif %}>
            <label class="form-check-label fw-medium">
              Publish to specific companies
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Specific Companies -->
    <div id="specificCompanies" class="collapse">
      <div class="card border">
        <div class="card-body">
          <h6 class="fw-semibold mb-3">Select Companies</h6>

          {% for company in all_companies %}
          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   name="companies"
                   value="{{ company.id }}">
            <label class="form-check-label">
              {{ company.name }}
            </label>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="col-12 d-flex justify-content-end">
      <button type="submit" class="btn btn-brand px-5">
        Save Template
      </button>
    </div>

  </form>
</div>

<script>
  const radio = document.getElementById("publish_specific");
  const box = document.getElementById("specificCompanies");
  if (radio) {
    radio.addEventListener("change", () => box.classList.add("show"));
  }
</script>
{% endblock %}
